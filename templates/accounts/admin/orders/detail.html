{% extends 'shop/base/base.html' %}
{% block content %}
<h2>Pedido {{ order.order_number|default:order.id }}</h2>
<p><strong>Estado:</strong> {{ order.status }} {% if order.paid %}(pagado){% endif %}</p>
<p><strong>Cliente:</strong> {% if order.customer %}{{ order.customer.first_name }} {{ order.customer.last_name }} ({{ order.customer.email }}){% else %}-{% endif %}</p>
<p><strong>Envío:</strong> {{ order.shipping_method|default:"-" }} (coste: {{ order.shipping_cost }})</p>
<p><strong>Total:</strong> {{ order.total }}</p>
<form method="post" action="{% url 'accounts:admin_order_update_status' order.id %}">
  {% csrf_token %}
  <label>Nuevo estado:</label>
  <select name="status">
    {% for s in statuses %}
      <option value="{{ s }}" {% if order.status == s %}selected{% endif %}>{{ s }}</option>
    {% endfor %}
  </select>
  <label class="ms-2"><input type="checkbox" name="paid" value="1" {% if order.paid %}checked{% endif %}> Pagado</label>
  <button class="btn btn-primary btn-sm ms-2" type="submit">Actualizar</button>
</form>

<h3 class="mt-4">Artículos</h3>
<table class="table table-sm">
  <thead>
    <tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th></tr>
  </thead>
  <tbody>
  {% for it in items %}
    <tr>
      <td>{{ it.product.name }}</td>
      <td>{{ it.price }}</td>
      <td>{{ it.quantity }}</td>
      <td>{{ it.get_cost }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="4">Sin artículos</td></tr>
  {% endfor %}
  </tbody>
</table>
<a class="btn btn-link" href="{% url 'accounts:admin_orders' %}">Volver</a>
{% endblock %}